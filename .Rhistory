pred_proba <- predict(nm3,
new_data = vecino_test,
type = "prob")
pred_proba[1:20,]
vecino_r <- vecino_test %>%
dplyr::select(barrio) %>%
bind_cols(pred_class, pred_proba)
vecino_r[1:20, ]
conf_mat(vecino_r, truth = barrio,
estimate = .pred_class)
custom_metrics <- metric_set(accuracy, sens, precision, recall, f_meas, kap, mcc)
custom_metrics(vecino_r, truth = barrio, estimate = .pred_class)
roc_auc(vecino_r, truth = barrio, .pred_0)
vecino_r %>%
roc_curve(truth = barrio, .pred_0) %>%
autoplot()
elsoc_2017$s14
elsoc_2017$s15
elsoc_2016$s14
obs2<-left_join(elsoc_2017, elsoc_2016, by="idencuesta")%>%
mutate_at(vars(matches("c12")), ~ifelse(. < 2, 0, 1)) %>% # se reduce  una línea.
dplyr::mutate (sexo = case_when(m0_sexo == 1  ~ "hombre",
m0_sexo == 2  ~ "mujer")) %>%
#dplyr::mutate (edad = case_when(m0_edad %in% 18:29 ~ "joven",
#                                m0_edad %in% 30:65 ~ "adulto",
#                                m0_edad %in% 66:88 ~ "adulto_mayor")) %>%
dplyr::mutate (nivel_educ = case_when(m01 %in% 1:3 ~ "basica",
m01 %in% 4:5 ~ "media",
m01 %in% 6:7 ~ "tecnica",
m01 %in% 8:10~ "universitaria"))%>%
dplyr::mutate(confianza = case_when(c02==1~1,
TRUE~0))%>%
dplyr::select(JJVV=c12_01, Religiosa=c12_02, AAEE=c12_03, Deportiva=c12_04,
Partido=c12_05, Profesional=c12_06, Sindicato=c12_07, Caridad=c12_08,
Otras=c12_09, sexo,m0_edad,nivel_educ, promedio_isei, confianza, ponderador02)
obs2<-left_join(elsoc_2017, elsoc_2016, by="idencuesta")%>%
mutate_at(vars(matches("c12")), ~ifelse(. < 2, 0, 1)) %>% # se reduce  una línea.
#dplyr::mutate (sexo = case_when(m0_sexo == 1  ~ "hombre",
#                                m0_sexo == 2  ~ "mujer")) %>%
#dplyr::mutate (edad = case_when(m0_edad %in% 18:29 ~ "joven",
#                                m0_edad %in% 30:65 ~ "adulto",
#                                m0_edad %in% 66:88 ~ "adulto_mayor")) %>%
dplyr::mutate (nivel_educ = case_when(m01 %in% 1:3 ~ "basica",
m01 %in% 4:5 ~ "media",
m01 %in% 6:7 ~ "tecnica",
m01 %in% 8:10~ "universitaria"))%>%
dplyr::mutate(confianza = case_when(c02==1~1,
TRUE~0))%>%
dplyr::select(JJVV=c12_01, Religiosa=c12_02, AAEE=c12_03, Deportiva=c12_04,
Partido=c12_05, Profesional=c12_06, Sindicato=c12_07, Caridad=c12_08,
Otras=c12_09, sexo,m0_edad,nivel_educ, promedio_isei, confianza, ponderador02)
obs2<-left_join(elsoc_2017, elsoc_2016, by="idencuesta")%>%
mutate_at(vars(matches("c12")), ~ifelse(. < 2, 0, 1)) %>% # se reduce  una línea.
dplyr::mutate (sexo = case_when(m0_sexo == 1  ~ "hombre",
m0_sexo == 2  ~ "mujer"))
left_join(elsoc_2017, elsoc_2016, by="idencuesta")%>%
mutate_at(vars(matches("c12")), ~ifelse(. < 2, 0, 1)) %>% # se reduce  una línea.
dplyr::mutate (sexo = case_when(m0_sexo == 1  ~ "hombre",
m0_sexo == 2  ~ "mujer"))
obs2<-left_join(elsoc_2017, elsoc_2016, by="idencuesta")
View(obs2)
asoc<-elsoc_2016%>%splyr::select(idencuesta,c12_01, c12_02,c12_03, c12_04, c12_05,
c12_06, c12_07, c12_08, c12_09)
asoc<-elsoc_2016%>%dplyr::select(idencuesta,c12_01, c12_02,c12_03, c12_04, c12_05,
c12_06, c12_07, c12_08, c12_09)
obs2<-left_join(elsoc_2017, asoc, by="idencuesta")%>%
mutate_at(vars(matches("c12")), ~ifelse(. < 2, 0, 1)) %>% # se reduce  una línea.
dplyr::mutate (sexo = case_when(m0_sexo == 1  ~ "hombre",
m0_sexo == 2  ~ "mujer")) %>%
#dplyr::mutate (edad = case_when(m0_edad %in% 18:29 ~ "joven",
#                                m0_edad %in% 30:65 ~ "adulto",
#                                m0_edad %in% 66:88 ~ "adulto_mayor")) %>%
dplyr::mutate (nivel_educ = case_when(m01 %in% 1:3 ~ "basica",
m01 %in% 4:5 ~ "media",
m01 %in% 6:7 ~ "tecnica",
m01 %in% 8:10~ "universitaria"))%>%
dplyr::mutate(confianza = case_when(c02==1~1,
TRUE~0))%>%
dplyr::select(JJVV=c12_01, Religiosa=c12_02, AAEE=c12_03, Deportiva=c12_04,
Partido=c12_05, Profesional=c12_06, Sindicato=c12_07, Caridad=c12_08,
Otras=c12_09, sexo,m0_edad,nivel_educ, promedio_isei, confianza, ponderador02)
obs2<-left_join(elsoc_2017, asoc, by="idencuesta")%>%
mutate_at(vars(matches("c12")), ~ifelse(. < 2, 0, 1)) %>% # se reduce  una línea.
dplyr::mutate (sexo = case_when(m0_sexo == 1  ~ "hombre",
m0_sexo == 2  ~ "mujer")) %>%
#dplyr::mutate (edad = case_when(m0_edad %in% 18:29 ~ "joven",
#                                m0_edad %in% 30:65 ~ "adulto",
#                                m0_edad %in% 66:88 ~ "adulto_mayor")) %>%
dplyr::mutate (nivel_educ = case_when(m01 %in% 1:3 ~ "basica",
m01 %in% 4:5 ~ "media",
m01 %in% 6:7 ~ "tecnica",
m01 %in% 8:10~ "universitaria"))%>%
dplyr::mutate(confianza = case_when(c02==1~1,
TRUE~0))%>%
dplyr::select(JJVV=c12_01, Religiosa=c12_02, AAEE=c12_03, Deportiva=c12_04,
Partido=c12_05, Profesional=c12_06, Sindicato=c12_07, Caridad=c12_08,
Otras=c12_09, sexo,m0_edad,nivel_educ, confianza, ponderador02)
asoc<-elsoc_2016%>%dplyr::select(idencuesta,c12_01, c12_02,c12_03, c12_04, c12_05,
c12_06, c12_07, c12_08, c12_09)
obs2<-left_join(elsoc_2017, asoc, by="idencuesta")%>%
mutate_at(vars(matches("c12")), ~ifelse(. < 2, 0, 1)) %>% # se reduce  una línea.
dplyr::mutate (sexo = case_when(m0_sexo == 1  ~ "hombre",
m0_sexo == 2  ~ "mujer")) %>%
#dplyr::mutate (edad = case_when(m0_edad %in% 18:29 ~ "joven",
#                                m0_edad %in% 30:65 ~ "adulto",
#                                m0_edad %in% 66:88 ~ "adulto_mayor")) %>%
dplyr::mutate (nivel_educ = case_when(m01 %in% 1:3 ~ "basica",
m01 %in% 4:5 ~ "media",
m01 %in% 6:7 ~ "tecnica",
m01 %in% 8:10~ "universitaria"))%>%
dplyr::mutate(confianza = case_when(c02==1~1,
c02==3~1,
TRUE~0))%>%
dplyr::select(JJVV=c12_01, Religiosa=c12_02, AAEE=c12_03, Deportiva=c12_04,
Partido=c12_05, Profesional=c12_06, Sindicato=c12_07, Caridad=c12_08,
Otras=c12_09, sexo,m0_edad,nivel_educ, confianza, ponderador02)
obs2$confianza
hist(obs2$confianza)
ggplot(obs2, aes(x = confianza, fill = confianza)) +
geom_bar(fill = "blue", alpha = 0.5) +
geom_text(aes(label = scales::percent(..count../sum(..count..))),
color="white",
stat = "count",
position = position_stack(vjust = 0.5),
size = 4) + # Agregar etiquetas de texto con porcentajes
labs(title = "Confianza generalizada",
x = "Categorías",
y = "Frecuencia") +
theme_minimal()
ggplot(obs2, aes(x = confianza, fill = confianza)) +
geom_bar(fill = "blue", alpha = 0.5) +
geom_text(aes(label = scales::percent(..count../sum(..count..))),
color="white",
stat = "count",
position = position_stack(vjust = 0.5),
size = 4) + # Agregar etiquetas de texto con porcentajes
labs(title = "Confianza generalizada",
x = "Categorías",
y = "Frecuencia") +
theme_minimal()
ggplot(obs2, aes(x = confianza, fill = confianza)) +
geom_bar(fill = "blue", alpha = 0.5) +
geom_text(aes(label = scales::percent(..count../sum(..count..))),
color="white",
stat = "count",
position = position_stack(vjust = 0.5),
size = 4) + # Agregar etiquetas de texto con porcentajes
labs(title = "Confianza generalizada",
x = "Categorías",
y = "Frecuencia") +
theme_minimal()
# seed
set.seed(123)
# data split
vecino_split <- initial_split(obs2,
prop = 0.75,
strata = confianza)
vecino_split
confianza_split
# data split
confianza_split <- initial_split(obs2,
prop = 0.75,
strata = confianza)
confianza_split
# training data
confianza_train <- confianza_split %>% training()
# testing data
confianza_test <- confianza_split %>% testing()
# Número de filas
nrow(confianza_train)
nrow(confianza_test)
nm_confianza <- logistic_reg() %>%
set_engine("glm") %>%
set_mode("classification") %>%
fit(confianza~
sexo
+ m0_edad
+ nivel_educ
+ JJVV
+ Religiosa
+ AAEE
+ Deportiva
+ Partido
+ Profesional
+ Sindicato
+ Caridad
+ Otras
+ Religiosa*nivel_educ
+ AAEE*nivel_educ, data = confianza_train)
nm_confianza <- logistic_reg() %>%
set_engine("glm") %>%
set_mode("classification") %>%
fit(as.factor(confianza)~
sexo
+ m0_edad
+ nivel_educ
+ JJVV
+ Religiosa
+ AAEE
+ Deportiva
+ Partido
+ Profesional
+ Sindicato
+ Caridad
+ Otras
+ Religiosa*nivel_educ
+ AAEE*nivel_educ, data = confianza_train)
tidy(nm_confianza)
### Test Data Class Prediction
# Class prediction
pred_class <- predict(nm_confianza,
new_data = confianza_test,
type = "class")
pred_class[1:20,]
pred_class[1:100,]
View(pred_class)
# Probabilities of diabetes wrt pedigree
visreg(nm3, "ego_educ", scale="response", rug=2, xlab="pedigree level", ylab="P(diabetes)")
# Probabilities of diabetes wrt pedigree
visreg(nm3, "ego_educ", scale="response", rug=2, xlab="pedigree level", ylab="P(diabetes)")
pacman::p_load(tidymodels,
tidyverse,
kableExtra,
interplot,
margins,
sjPlot,
stargazer,
httr,
car,
lmtest,
sandwich,
texreg,
visreg)
# Probabilities of diabetes wrt pedigree
visreg(nm3, "ego_educ", scale="response", rug=2, xlab="pedigree level", ylab="P(diabetes)")
# Probabilities of diabetes wrt pedigree
visreg(m3, "ego_educ", scale="response", rug=2, xlab="pedigree level", ylab="P(diabetes)")
# Probabilities of diabetes wrt pedigree
visreg(m3, "ego_educ", by="educ_dist", scale="response", rug=2, xlab="pedigree level", ylab="P(diabetes)")
# Probabilities of diabetes wrt pedigree
visreg(m3, "ego_educ", scale="response", rug=2, xlab="pedigree level", ylab="P(diabetes)")
me<-summary(margins(m3, variables = c("nivel_educ")))
me<-summary(margins(m3, variables = c("ego_educ")))
glimpse(me)
me2 <- summary(margins(m3, at = list(educ_dist1 = c("1", "0")), variables = "nivel_educ"))
me2 <- summary(margins(nm3, at = list(educ_dist1 = c("1", "0")), variables = "nivel_educ"))
obs$educ_dist1
me2 <- summary(margins(nm3, at = list(educ_dist1 = c(1,0)), variables = "nivel_educ"))
nm3
me2 <- summary(margins(nm3, at = list("educ_dist1" = c(1,0)), variables = "nivel_educ"))
me2 <- summary(margins(nm3, at = list("educ_dist1" = c("1","0")), variables = "nivel_educ"))
me2 <- summary(margins(m3, at = list("educ_dist1" = c("1","0")), variables = "nivel_educ"))
me2 <- summary(margins(m3, at = "educ_dist1", variables = "nivel_educ"))
me2 <- summary(margins(m3, at = list("educ_dist1" = c("si","no")), variables = "nivel_educ"))
m3
me2 <- summary(margins(m3)
me2
me2 <- summary(margins(m3))
me2
me2 <- summary(margins(m3, at = list("educ_dist1" = c("0","1")), variables = "nivel_educ"))
m3<-glm(barrio~
ego_sexo
+ ego_educ
+ ego_edad
+ expresivas
+ instrument
+ t01
+ neigh_attach
+ sexo_dist1
+ educ_dist1
+ ideol_dist1
+ relig_dist1
+ ego_educ*educ_dist1, data = obs, family = "binomial")
summary(m3)
m3<-glm(barrio~
ego_sexo
+ ego_educ
+ ego_edad
+ expresivas
+ instrument
+ t01
+ neigh_attach
+ sexo_dist1
+ factor(educ_dist1)
+ ideol_dist1
+ relig_dist1
+ ego_educ*factor(educ_dist1), data = obs, family = "binomial")
summary(m3)
m3<-glm(barrio~
ego_sexo
+ ego_educ
+ ego_edad
+ expresivas
+ instrument
+ t01
+ neigh_attach
+ factor(sexo_dist1)
+ factor(educ_dist1)
+ factor(ideol_dist1)
+ factor(relig_dist1)
+ ego_educ*factor(educ_dist1), data = obs, family = "binomial")
summary(m3)
me2 <- summary(margins(m3, at = list("educ_dist1" = c("0","1")), variables = "nivel_educ"))
me2 <- summary(margins(m3, at = list("factor(educ_dist1)" = c("0","1")), variables = "nivel_educ"))
me2 <- summary(margins(m3, at = list("factor(educ_dist1)" = c("0","1")), variables = "nivel_educ"))
me2 %>% kbl(caption = "Efectos marginales") %>% kable_classic("hover", full_width = T)
me2 <- summary(margins(m3, at = list(educ_dist1 = c("0","1")), variables = "nivel_educ"))
me2 <- summary(margins(m3, at = list(educ_dist1), variables = "nivel_educ"))
me2 <- summary(margins(m3, at = list(educ_dist1 = c("0","1")), variables = "ego_educ))
me2 <- summary(margins(m3, at = list(educ_dist1 = c("0","1")), variables = "ego_educ"))
me2 <- summary(margins(m3, at = list(educ_dist1 = c(0,1)), variables = "ego_educ"))
me2 %>% kbl(caption = "Efectos marginales") %>% kable_classic("hover", full_width = T)
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
facet_grid(.~ego_educ) +
#scale_x_discrete(labels=c("nivel_educmedia" = "Media",
#                        "nivel_eductecnica" = "Técnica",
#                        "nivel_educuniversitaria" = "Universitaria"))+
xlab("") +
ylab("Efectos marginales")+
theme(axis.ticks.y=element_blank(),
legend.position = "right",
plot.title = element_text(hjust = 0.5, size = 9),
axis.title = element_text(size=10),
axis.text.x = element_text(size=11),
axis.text.y = element_text(size = 9),
legend.text = element_text(size = 10),
legend.title = element_text(face = "bold",
size = 10))
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
#facet_grid(.~ego_educ) +
#scale_x_discrete(labels=c("nivel_educmedia" = "Media",
#                        "nivel_eductecnica" = "Técnica",
#                        "nivel_educuniversitaria" = "Universitaria"))+
xlab("") +
ylab("Efectos marginales")+
theme(axis.ticks.y=element_blank(),
legend.position = "right",
plot.title = element_text(hjust = 0.5, size = 9),
axis.title = element_text(size=10),
axis.text.x = element_text(size=11),
axis.text.y = element_text(size = 9),
legend.text = element_text(size = 10),
legend.title = element_text(face = "bold",
size = 10))
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
facet_grid(.~dist_educ1) +
#scale_x_discrete(labels=c("nivel_educmedia" = "Media",
#                        "nivel_eductecnica" = "Técnica",
#                        "nivel_educuniversitaria" = "Universitaria"))+
xlab("") +
ylab("Efectos marginales")+
theme(axis.ticks.y=element_blank(),
legend.position = "right",
plot.title = element_text(hjust = 0.5, size = 9),
axis.title = element_text(size=10),
axis.text.x = element_text(size=11),
axis.text.y = element_text(size = 9),
legend.text = element_text(size = 10),
legend.title = element_text(face = "bold",
size = 10))
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
facet_grid(.~"educ_dist1") +
#scale_x_discrete(labels=c("nivel_educmedia" = "Media",
#                        "nivel_eductecnica" = "Técnica",
#                        "nivel_educuniversitaria" = "Universitaria"))+
xlab("") +
ylab("Efectos marginales")+
theme(axis.ticks.y=element_blank(),
legend.position = "right",
plot.title = element_text(hjust = 0.5, size = 9),
axis.title = element_text(size=10),
axis.text.x = element_text(size=11),
axis.text.y = element_text(size = 9),
legend.text = element_text(size = 10),
legend.title = element_text(face = "bold",
size = 10))
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
facet_grid(.~ educ_dist1) +
#scale_x_discrete(labels=c("nivel_educmedia" = "Media",
#                        "nivel_eductecnica" = "Técnica",
#                        "nivel_educuniversitaria" = "Universitaria"))+
xlab("") +
ylab("Efectos marginales")+
theme(axis.ticks.y=element_blank(),
legend.position = "right",
plot.title = element_text(hjust = 0.5, size = 9),
axis.title = element_text(size=10),
axis.text.x = element_text(size=11),
axis.text.y = element_text(size = 9),
legend.text = element_text(size = 10),
legend.title = element_text(face = "bold",
size = 10))
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
facet_grid(.~ educ_dist1) +
scale_x_discrete(labels=c("ego_educ2" = "Media (ego)",
"ego_educ3" = "Técnica (ego)",
"ego_educ4" = "Universitaria (ego)"))+
xlab("") +
ylab("Efectos marginales")+
theme(axis.ticks.y=element_blank(),
legend.position = "right",
plot.title = element_text(hjust = 0.5, size = 9),
axis.title = element_text(size=10),
axis.text.x = element_text(size=11),
axis.text.y = element_text(size = 9),
legend.text = element_text(size = 10),
legend.title = element_text(face = "bold",
size = 10))
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
facet_grid(.~ educ_dist1) +
scale_x_discrete(labels=c("ego_educ2" = "Media (ego)",
"ego_educ3" = "Técnica (ego)",
"ego_educ4" = "Universitaria (ego)"))+
xlab("") +
ylab("Average Marginal Effect (AME)")+
theme(axis.ticks.y=element_blank(),
legend.position = "right",
plot.title = element_text(hjust = 0.5, size = 9),
axis.title = element_text(size=10),
axis.text.x = element_text(size=11),
axis.text.y = element_text(size = 9),
legend.text = element_text(size = 10),
legend.title = element_text(face = "bold",
size = 10))
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
facet_grid(.~ educ_dist1) +
scale_x_discrete(labels=c("ego_educ2" = "Media (ego)",
"ego_educ3" = "Técnica (ego)",
"ego_educ4" = "Superior (ego)"))+
xlab("") +
ylab("Average Marginal Effect (AME)")+
theme(axis.ticks.y=element_blank(),
legend.position = "right",
plot.title = element_text(hjust = 0.5, size = 9),
axis.title = element_text(size=10),
axis.text.x = element_text(size=11),
axis.text.y = element_text(size = 9),
legend.text = element_text(size = 10),
legend.title = element_text(face = "bold",
size = 10))
me<-summary(margins(nm3, variables = c("ego_educ")))
me<-summary(margins(m3, variables = c("ego_educ")))
glimpse(me)
tidy(nm3)
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
facet_grid(.~ educ_dist1,
labeller = as_labeller(c(0='No distancia',
me2%>%
ggplot(aes(x =factor, y= AME)) +
geom_point() +
geom_line(group="factor") +
geom_errorbar(aes(ymin = lower, ymax = upper), alpha = 1, width=0.2)+
facet_grid(.~ educ_dist1,
labeller = as_labeller(c("0"='No distancia',
"1"='Distancia'))) +
scale_x_discrete(labels=c("ego_educ2" = "Media (ego)",
"ego_educ3" = "Técnica (ego)",
"ego_educ4" = "Superior (ego)"))+
xlab("") +
ylab("Average Marginal Effect (AME)")+
theme(axis.ticks.y=element_blank(),
legend.position = "right",
plot.title = element_text(hjust = 0.5, size = 9),
axis.title = element_text(size=10),
axis.text.x = element_text(size=11),
axis.text.y = element_text(size = 9),
legend.text = element_text(size = 10),
legend.title = element_text(face = "bold",
size = 10))
persp(m3, "educ_dist1", "ego_educ")
image(m3, "educ_dist1", "ego_educ")
conf_mat(vecino_r, truth = barrio,
estimate = .pred_class)
custom_metrics <- metric_set(accuracy, sens, precision, recall, f_meas, kap, mcc)
custom_metrics(vecino_r, truth = barrio, estimate = .pred_class)
roc_auc(vecino_r, truth = barrio, .pred_0)
