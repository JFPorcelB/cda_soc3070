---
title: "Ayudant√≠a 8"
subtitle: "An√°lisis de Datos Categ√≥ricos"
author: "Roberto Vel√°zquez"
institute: üíª üìä üé®üéªüé∑ 
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default","default-fonts","gentle-r.css"]
    df_print: default
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
      slideNumberFormat: "%current%"
editor_options: 
  chunk_output_type: console
---

# A.- Caso de Estudio

Trabajemos sobre los datos de la **National Survey of Culture and the Arts 2018** vista en la ayudant√≠a pasada. Recordemos que la encuesta fue coordinada por el *National Endowment for the Arts USA* con un muestreo representativo de la poblaci√≥n de EEUU. La muestra contiene 8609 y 12 de variables de inter√©s.

![](nefa.png)

---

# A.- Caso de Estudio

- Codififaci√≥n de variables: 

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
library(tibble)
```

```{r echo=TRUE, comment='#'}
#Cargar base de datos
load("nsca2018.Rda")
tibble(data1)
```

---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.-Ajuste un modelo de regresi√≥n log√≠stica multinomial para estimar el nivel de educaci√≥n de los p√∫blicos de m√∫sica en Estados Unidos, a partir de la interacci√≥n entre asistencia a eventos de jazz y m√∫sica cl√°sica. Note que nivel educacional (**edu_b**) es un factor donde **1- Educaci√≥n Secundaria Completa**, **2- Educaci√≥n T√©cnico/Universitaria Completa**, y **3.- Educaci√≥n de Posgrado Completa**.

--

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
library(tidyverse)
library(car)
```

```{r echo=TRUE, comment='#'}
#Sintaxis
#Conversi√≥n de factor a vector (tidyverse)
data1 <- data1 %>% 
  mutate(jazz_b = as.numeric(jazz))
data1 <- data1 %>% 
  mutate(clasica_b = as.numeric(clasica))
data1 <- data1 %>% 
  mutate(edu_b = as.factor(edu_b))

# Codificaci√≥n dummies (car)
data1$clasica_b <- recode(data1$clasica_b, "1=1; 2=0")
data1$jazz_b <- recode(data1$jazz_b, "1=1; 2=0")
```
---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.-Ajuste un modelo de regresi√≥n log√≠stica multinomial para estimar el nivel de educaci√≥n de los p√∫blicos de m√∫sica en Estados Unidos, a partir de la interacci√≥n entre asistencia a eventos de jazz y m√∫sica cl√°sica. Note que nivel educacional (**edu_b**) es un factor donde **1- Educaci√≥n Secundaria Completa**, **2- Educaci√≥n T√©cnico/Universitaria Completa**, y **3.- Educaci√≥n de Posgrado Completa**.

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
library(nnet)
```

*R:*

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
#Ajuste Modelo
ml_model1 <- multinom(edu_b ~ jazz_b*clasica_b, data=data1) 
```
---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.-Ajuste un modelo de regresi√≥n log√≠stica multinomial para estimar el nivel de educaci√≥n de los p√∫blicos de m√∫sica en Estados Unidos, a partir de la interacci√≥n entre asistencia a eventos de jazz y m√∫sica cl√°sica. Note que nivel educacional (**edu_b**) es un factor donde **1- Educaci√≥n Secundaria Completa**, **2- Educaci√≥n T√©cnico/Universitaria Completa**, y **3.- Educaci√≥n de Posgrado Completa**.

*R:*

```{r echo=TRUE, comment='#'}  
summary(ml_model1)
```
---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.1-Interprete los coeficientes de asistencia a eventos de jazz y la interacci√≥n de asistencia a jazz y m√∫sica cl√°sica para cada nivel de educaci√≥n de los p√∫blicos asistentes.

--

*R:*

- *(jazz|2)*: El coeficiente asociado a jazz indica que las log-odds de que un asistente a este tipo de eventos musicales tenga educaci√≥n universitaria completa en comparaci√≥n con solo tener educaci√≥n secundaria completa son 1.000061 mayores que las de quienes no han asistido durante el a√±o a eventos de m√∫sica cl√°sica. 

- *(jazz|3)*: El coeficiente asociado a jazz indica que las log-odds de que un asistente a este tipo de eventos musicales tenga educaci√≥n de posgrado completa en comparaci√≥n con solo tener educaci√≥n secundaria completa son 1.588784 mayores que las de quienes no han asistido durante el a√±o a eventos de m√∫sica cl√°sica. 

- *(jazz:clasica|2)*: El coeficiente interactivo entre m√∫sica jazz y cl√°sica indica que las log-odds de que un asistente a este tipo de eventos musicales tenga educaci√≥n universitaria completa en comparaci√≥n con solo tener educaci√≥n secundaria completa son 0.5354649 menores para un asistente a ambos tipos de eventos.

- *(jazz:clasica|3)*: El coeficiente interactivo entre m√∫sica jazz y cl√°sica indica que las log-odds de que un asistente a este tipo de eventos musicales tenga educaci√≥n de posgrado completa en comparaci√≥n con solo tener educaci√≥n secundaria completa son 1.0682897 menores para un asistente a ambos tipos de eventos.

---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.2- Transforma e interpreta los coeÔ¨Åcientes correspondiente *(clasica|2)* y *(clasica|3)* en t√©rminos de *odds ratio* (o probabilidades relativas). 

--

*R:*

Formalmente (Ejemplo nivel 2 en educaci√≥n):

$\ln \frac{\mathbb{P}(\text{2 | clasica=1, jazz=0)}}{\mathbb{P}(\text{1 | clasica=1, jazz=0)}} = \beta_{0} + \beta_{clasica}$

Por tanto,


- $\frac{\mathbb{P}(\text{2 | clasica=1, jazz=0)}}{\mathbb{P}(\text{1 | clasica=1, jazz=0)}} = e^{\beta_{0(2)} + \beta_{clasica(2)}} = e^{\beta_{0(2)}} e^{\beta_{clasica(2)}}$

y

- $\frac{\mathbb{P}(\text{2 | clasica=1, jazz=0)}}{\mathbb{P}(\text{1 | clasica=1, jazz=0)}} = e^{\beta_{0-(2)}}$

As√≠, se sigue de esto que


$\frac{\mathbb{P}(\text{2 | clasica=0, jazz=0)}}{\mathbb{P}(\text{1 | clasica=0, jazz=0)}} \bigg/ \frac{\mathbb{P}(\text{2 | clasica=1, jazz=0)}}{\mathbb{P}(\text{1 | clasica=1, jazz=0)}} = e^{\beta_{0(2)}} e^{\beta_{clasica (2)}} / e^{\beta_{0(2)}} = e^{\beta_{clasica (2)}} = e^{1.429321} = 4.1758646$

---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.2- Transforma e interpreta los coeÔ¨Åcientes correspondiente *(clasica|2)* y *(clasica|3)* en t√©rminos de *odds ratio* (o probabilidades relativas). 

--

*R:*

```{r echo=TRUE, comment='#'}  
exp1 <- exp(summary(ml_model1)$coefficients)
exp1
exp(1.429321)
```

El ratio entre la probabilidad de tener educaci√≥n universitaria completa y tener educaci√≥n secundaria completa por parte de quienes asisten a escuchar m√∫sica cl√°sica y no m√∫sica jazz durante el a√±o es 4.175 el ratio observado de quienes tienen educaci√≥n secundaria completa y escuchan jazz.

---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.2- Transforma e interpreta los coeÔ¨Åcientes correspondiente *(clasica|2)* y *(clasica|3)* en t√©rminos de *odds ratio* (o probabilidades relativas). 

--

*R:*

```{r echo=TRUE, comment='#'}  
exp1 <- exp(summary(ml_model1)$coefficients)
exp1
exp(2.542503)
```

El ratio entre la probabilidad de tener educaci√≥n de posgrado completa y tener educaci√≥n secundaria completa por parte de quienes asisten a escuchar m√∫sica cl√°sica y no m√∫sica jazz durante el a√±o es 12.71145 el ratio observado de quienes tienen educaci√≥n secundaria completa y escuchan jazz.

---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.3. Calcula la odds ratio de tener educaci√≥n de posgrado completa en vez de educaci√≥n universitaria completa entre los publicos que no asisten a conciertos de m√∫sica cl√°sica y s√≠ asisten a conciertos de jazz.

--

*R:*

Formalmente:

$$e^{\beta_{clasica(3)} - \beta_{clasica(2)}} = e^{(2.542503 - 1.429321)} = 3.044029$$
```{r echo=TRUE, comment='#'}  
exp1 <- exp(summary(ml_model1)$coefficients)
exp1
oddr_23 <- exp(2.542503 - 1.429321)
oddr_23
```
---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.3. Calcula la odds ratio de tener educaci√≥n de posgrado completa en vez de educaci√≥n universitaria completa entre los publicos que no asisten a conciertos de m√∫sica cl√°sica y s√≠ asisten a conciertos de jazz.

--

*R:*

Formalmente:

$$e^{\beta_{clasica(3)} - \beta_{clasica(2)}} = e^{(12.711443 - 4.175864)} = 3.044029$$ 

El ratio entre la probabilidad de tener educaci√≥n de posgrado completa para quienes no asisten a conciertos de m√∫sica cl√°sica pero s√≠ asisten a conciertos de jazz durante el a√±o es 3.044029 el ratio observado de quienes tienen educaci√≥n universitaria completa y no asisten a conciertos de m√∫sica cl√°sica pero s√≠ asisten a conciertos de jazz.

---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.4 Manipula los resultados del modelo para obtener las probabilidades esperadas de que los asistentes a conciertos de m√∫sica jazz ‚Äì que adem√°s asisten y no asisten a conciertos de m√∫sica cl√°sica ‚Äì tengan educaci√≥n universitaria completa. 

--

*R:*

Considerando que,

$p_{ji} =\frac{e^{\beta_{j0} + \beta_{j1}x_{1i} + \dots + \beta_{jk}x_{ki}}}{1 + \sum^{J-1}_{j=1}  e^{\beta_{j0} + \beta_{j1}x_{1i} + \dots + \beta_{jk}x_{ki}}}$


Por tanto:

$\mathbb{P}(\text{2 | jazz=1, clasica=0}) = \frac{e^{\beta_{0(2)}}}{1 + e^{\beta_{0(2)}} + e^{\beta_{0(3)}} } = e^{0.108}/(1 + e^{0.108} + e^{-1.50}) = 0.591$

$\mathbb{P}(\text{2 | jazz=1, clasica=1}) = \frac{e^{\beta_{0(2)} + \beta_{clasica(2)}}}{1 + e^{(\beta_{0(2)} + \beta_{clasica (2)}}  + e^{(\beta_{0(3)} + \beta_{clasica (3)})} } = e^{0.108 + 1.429}/(1 + e^{0.108 + 1.429} + e^{-1.50 + 2.542}) = 0.562$

---

# B.- Regresi√≥n Log√≠stica Multinomial - Ejercicio

1.4 Manipula los resultados del modelo para obtener las probabilidades esperadas de que los asistentes a conciertos de m√∫sica jazz ‚Äì que adem√°s asisten y no asisten a conciertos de m√∫sica cl√°sica ‚Äì tengan educaci√≥n universitaria completa. 

--

*R:*

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
library(modelr)
```

```{r echo=TRUE, comment='#'}  
newx1 <- data1 %>% data_grid(jazz_b=1,clasica_b,.model=ml_model1) 
newy1 <- cbind(newx1,predict(ml_model1, newdata = newx1, type = "probs"))
print(newy1)
```
---

# C.- Regresi√≥n Log√≠stica Ordenada - Ejercicio

2.- Ajuste un modelo de regresi√≥n log√≠stica ordenada para estimar el nivel de educaci√≥n de los p√∫blicos de m√∫sica en Estados Unidos, a partir de la interacci√≥n entre asistencia a eventos de jazz y m√∫sica cl√°sica. Note que nivel educacional (**edu_b**) es un una variable ordenada ascendente donde **1- Educaci√≥n Secundaria Completa**, **2- Educaci√≥n T√©cnico/Universitaria Completa**, y **3.- Educaci√≥n de Posgrado Completa**.

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
library(MASS)
```
--

*R:*

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
ologit_1 <- polr(edu_b ~ jazz_b*clasica_b, data=data1)
```

---

# C.- Regresi√≥n Log√≠stica Ordenada - Ejercicio

2.- Ajuste un modelo de regresi√≥n log√≠stica ordenada para estimar el nivel de educaci√≥n de los p√∫blicos de m√∫sica en Estados Unidos, a partir de la interacci√≥n entre asistencia a eventos de jazz y m√∫sica cl√°sica. Note que nivel educacional (**edu_b**) es un una variable ordenada ascendente donde **1- Educaci√≥n Secundaria Completa**, **2- Educaci√≥n T√©cnico/Universitaria Completa**, y **3.- Educaci√≥n de Posgrado Completa**.

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
summary(ologit_1)
```

---

# C.- Regresi√≥n Log√≠stica Ordenada - Ejercicio

2.1- Interprete los coeficientes de asistencia a eventos de jazz y la interacci√≥n de asistencia a jazz y m√∫sica cl√°sica para cada nivel de educaci√≥n de los p√∫blicos asistentes.

--

*R:*

- *(jazz)*: El coeÔ¨Åciente asociado a jazz indica que, en promedio, los no asistentes a espect√°culos de m√∫sica cl√°sica y que s√≠ asisten a espect√°culos de jazz tienen 1.0451 punto m√°s en la variable latente de nivel de educaci√≥n comparado con los no asistentes a m√∫sica cl√°sica y s√≠ asistentes a espect√°culos de jazz de educaci√≥n escolar completa.

- *(jazz:clasica)*: En tanto, el coeÔ¨Åciente asociado a la interacci√≥n jazz:clasica indica que los los asistentes a m√∫sica jazz y cl√°sica tienen, en promedio, 0.1865 puntos m√°s  en la variable latente de nivel de educaci√≥n comparado con los si asistentes a m√∫sica cl√°sica y s√≠ asistentes a espect√°culos de jazz de educaci√≥n escolar completa ( $\beta_{jazz} + \beta_{jazz:clasica} = 0.1865$ )  y 0.7669 puntos m√°s en la variable latente de nivel de educaci√≥n comparado con los no asistentes a m√∫sica cl√°sica y s√≠ asistentes a espect√°culos de jazz de educaci√≥n escolar completa ( $\beta_{cl√°sica} + \beta_{jazz:clasica} = 0.7669$ ).

---

# C.- Regresi√≥n Log√≠stica Ordenada - Ejercicio

2.2- Transforma e interpreta el coeficientes correspondiente a "jazz" en t√©rminos de odds-ratios acumulativas. 

--

*R:*

Para los asistentes a espect√°culos de jazz que no asisten a conciertos de m√∫sica cl√°sica el logit acumulado de la probabilidadad de educaci√≥n secundaria o universitaria (categor√≠as 1 o 2) est√° dado por:

$\ln \frac{\mathbb{P}( y \leq \text{2 | jazz=1, clasica=0)}}{\mathbb{P}(y >\text{2 | jazz=1, clasica=0)}} = \alpha_{\text{2|3}} - \beta_{jazz}$

y para los no asistentes de m√∫sica jazz y cl√°sica , el mismo logit est√° dado por:

$\ln \frac{\mathbb{P}( y \leq \text{2 | jazz=0, clasica=0)}}{\mathbb{P}(y >\text{2 | jazz=0, clasica=0)}} = \alpha_{\text{2|3}}$


En t√©rminos de odds:

$\frac{\mathbb{P}( y \leq \text{2 | jazz=1, clasica=0)}}{\mathbb{P}(y >\text{2 | jazz=1, clasica=0)}} = e^{\alpha_{\text{2|3}}} \cdot e^{-\beta_{jazz}}$

y

$\frac{\mathbb{P}(  y \leq \text{2 | jazz=0, clasica=0)}}{\mathbb{P}(y >\text{2 | jazz=0, clasica=0)}} = e^{\alpha_{\text{2|3}}}$

---

# C.- Regresi√≥n Log√≠stica Ordenada - Ejercicio

2.2- Transforma e interpreta el coeficientes correspondiente a "jazz" en t√©rminos de odds-ratios acumulativas. 

*R:*

Se sigue de esto que

$\frac{\mathbb{P}(y \leq \text{2 | jazz=1, clasica=0)} / \mathbb{P}(y >\text{2 | jazz=1, clasica=0)} }{\mathbb{P}( y \leq \text{2 | jazz=0, clasica=0)} / \mathbb{P}(y >\text{2 | jazz=0, clasica=0)}} = e^{-\beta_{jazz}}$

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
exp(-(summary(ologit_1)$coefficients))
```

Es decir, las odds acumulada de la probabilidadad de educaci√≥n secundaria o universitaria (categor√≠as 1 o 2) de quienes asistentes a espect√°culos de jazz y no asisten a conciertos de m√∫sica cl√°sica es 0.351 las odds de quienes no asisten a espectaculos de jazz ni de m√∫sica cl√°sica.

---

# C.- Regresi√≥n Log√≠stica Ordenada - Ejercicio

2.3- Manipula los resultados del modelo para obtener las probabilidades esperadas de que los asistentes a conciertos de jazz ‚Äì siendo adem√°s asistentes y no asistentes a conciertos de m√∫sica cl√°sica ‚Äì tengan educaci√≥n de posgrado completa. Expresa formalmente las ecuaciones correspondiente a estas predicciones. 

--

*R:*

$\mathbb{P}(y = \text{3 | jazz=1, clasica=0)} = 1- \text{logit}^{-1}(\alpha_{\text{2|3}}) = 1 - 1/(1 + e^{-\alpha_{\text{2|3}}}) = 0.2247270$

$\mathbb{P}(y = \text{3 | jazz=1, clasica=1)} = 1- \text{logit}^{-1}(\alpha_{\text{2|3}}  - \beta_{clasica}) = 1 - 1/(1 + e^{-(\alpha_{\text{2|3}}  - \beta_{clasica})}) = 0.3842845$
---

# C.- Regresi√≥n Log√≠stica Ordenada - Ejercicio

2.3- Manipula los resultados del modelo para obtener las probabilidades esperadas de que los asistentes a conciertos de jazz ‚Äì siendo adem√°s asistentes y no asistentes a conciertos de m√∫sica cl√°sica ‚Äì tengan educaci√≥n de posgrado completa. Expresa formalmente las ecuaciones correspondiente a estas predicciones. 

*R:*

```{r echo=TRUE, message=FALSE, warning=FALSE, comment='#'}
newx2 <- data1 %>% data_grid(jazz_b=1,clasica_b,.model=ologit_1) 
newy2 <- cbind(newx2,predict(ologit_1, newdata = newx2, type = "probs"))
print(newy2)
```
---

# Referencias Sugeridas:

‚Ä¢ Laurie Hanquinet & Mike Savage (2016). Routledge International Handbook of the Sociology of Art and Culture. London: Routledge.

‚Ä¢ Hadley Wickham (2015). Advanced R, CRC Press, Taylor & Francis Group, Boca Raton, FL. En https://adv-r.hadley.nz/

‚Ä¢ Hadley Wickham and Garrett Grolemund (2017). R for Data Science. Import, Tidy, Transform, Visualize, and Model Data. O‚ÄôReilly Media, Inc.. En https://r4ds.had.co.nz/


---

class: inverse, center, middle

.huge[
**¬°Hasta la pr√≥xima!**
]

 üíª üìä üé®üéªüé∑ 
 
<br>
Roberto Vel√°zquez <br>
https://github.com/rovelazqu <br>





